{{- $root := . }}
{{- if hasKey .Values.global "prometheus" }}
{{- range .Values.global.projectLabels }}
{{- range $project, $labels := . }}
---
apiVersion: monitoring.coreos.com/v1
kind: Prometheus
metadata:
  name: prometheus-central
  namespace: mon
  labels:
    {{- $root.Values.global.centralProjectLabels | toYaml | nindent 4 }}
spec:
  replicas: 1
  serviceMonitorSelector:
    matchLabels:
      {{- $root.Values.global.centralProjectLabels | toYaml | nindent 6 }}
  podMetadata:
    labels:
      {{- $root.Values.global.centralProjectLabels | toYaml | nindent 6 }}
  nodeSelector:
    {{- $root.Values.global.centralProjectLabels | toYaml | nindent 4 }}
  tolerations:
  {{- $root.Values.global.centralMonitoringTolerations | toYaml | nindent 2 }}
  ruleSelector: {}
  resources:
    requests:
      memory: 2Gi
      cpu: 500m
  serviceAccountName: {{ include "prometheus_serviceaccount_name" . }}
  {{- if hasKey $root.Values.global.prometheus "storage" }}
  storage:
    {{-  $root.Values.global.prometheus.storage | toYaml | nindent 4 }}
  {{- end }}
  version: {{ $root.Values.global.prometheus.version }}
  {{- if hasKey $root.Values.global.prometheus "remoteWrite" }}
  remoteWrite:
  {{-  $root.Values.global.prometheus.remoteWrite | toYaml | nindent 2 }}
  {{- end }}
{{- end }}
{{- end }}
{{- end }}
